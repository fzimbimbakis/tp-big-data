{
	"name": "dataflow1",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "TransactionsInput",
						"type": "DatasetReference"
					},
					"name": "Transactions",
					"description": "Import data from bt_transactions"
				}
			],
			"sinks": [],
			"transformations": [
				{
					"name": "RelevantCols"
				},
				{
					"name": "NonNullUsers",
					"description": "Remove non-null users"
				},
				{
					"name": "SegmentValidation"
				},
				{
					"name": "MapSegment",
					"description": "Rewrite segment column to Individual or Seller"
				}
			],
			"scriptLines": [
				"source(output(",
				"          Prop_0 as string,",
				"          user_id as string,",
				"          transaction_dt as date,",
				"          type as integer,",
				"          segment as integer",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> Transactions",
				"Transactions select(mapColumn(",
				"          user_id,",
				"          transaction_dt,",
				"          type,",
				"          segment",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> RelevantCols",
				"RelevantCols filter(!isNull(user_id)) ~> NonNullUsers",
				"NonNullUsers filter((segment == 1 && type >= 1 && type <= 7) || (segment == 2 && (type == 8 || type == 9))) ~> SegmentValidation",
				"SegmentValidation derive(segment = iif(segment == 1, 'Individual', 'Seller')) ~> MapSegment"
			]
		}
	}
}